using Akiled.Communication.Packets.Outgoing;using Akiled.HabboHotel.GameClients;using Akiled.HabboHotel.Guides;namespace Akiled.Communication.Packets.Incoming.Structure{    class OnGuide : IPacketEvent    {        public void Parse(GameClient Session, ClientPacket Packet)        {
            int userId = Packet.PopInt();            string message = Packet.PopString();            GuideManager guideManager = AkiledEnvironment.GetGame().GetGuideManager();            if (guideManager.GuidesCount <= 0)            {                ServerPacket Response = new ServerPacket(ServerPacketHeader.OnGuideSessionError);                Response.WriteInteger(2);                Session.SendPacket(Response);                return;            }            if (Session.GetHabbo().OnDuty == true)            {                guideManager.RemoveGuide(Session.GetHabbo().Id);            }            int guideId = guideManager.GetRandomGuide();            if (guideId == 0)            {                ServerPacket Response = new ServerPacket(ServerPacketHeader.OnGuideSessionError);                Response.WriteInteger(2);                Session.SendPacket(Response);                return;            }            GameClient guide = AkiledEnvironment.GetGame().GetClientManager().GetClientByUserID(guideId);            ServerPacket onGuideSessionAttached = new ServerPacket(ServerPacketHeader.OnGuideSessionAttached);            onGuideSessionAttached.WriteBoolean(false);            onGuideSessionAttached.WriteInteger(userId);            onGuideSessionAttached.WriteString(message);            onGuideSessionAttached.WriteInteger(30); //Temps moyen
            Session.SendPacket(onGuideSessionAttached);            ServerPacket onGuideSessionAttached2 = new ServerPacket(ServerPacketHeader.OnGuideSessionAttached);            onGuideSessionAttached2.WriteBoolean(true);            onGuideSessionAttached2.WriteInteger(userId);            onGuideSessionAttached2.WriteString(message);            onGuideSessionAttached2.WriteInteger(15);            guide.SendPacket(onGuideSessionAttached2);            guide.GetHabbo().GuideOtherUserId = Session.GetHabbo().Id;            Session.GetHabbo().GuideOtherUserId = guide.GetHabbo().Id;        }    }}